#!/usr/bin/env bash

# Lipstick build script.

echo "Building Lipstick on a Pigâ€¦"

# Helpers.
INSTALL="dist/install"
function write  { echo "${1}" >> "${INSTALL}"; }
function insert { cat "${1}" >> "${INSTALL}";  }

scripts=()
PREFIX="lipstick-"
fileNames=(
  "${PREFIX}configure" 
  "${PREFIX}disable" 
  "${PREFIX}enable" 
  "${PREFIX}monitor" 
  "${PREFIX}uninstall" 
  "${PREFIX}update" 
  "${PREFIX}apps"
  "lipstick.service"
)

# Prepare distribution folder.
rm -rf ./dist
mkdir -p ./dist

# Start creating install script.
insert ./template/head.bash

# Bundle all source files into install script.
for fileName in "${fileNames[@]}"
do
  tempVar="_${fileName}"
  write ""
  write "read -rd '' ${tempVar} <<-EOF"
  insert "./src/${fileName}"
  write "EOF"
  write "files[${fileName}]=${tempVar}"
  write ""
  write "######################################################################"
done

# Complete install script.
insert ./template/main.bash

echo 'Done.'
