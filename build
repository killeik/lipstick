#!/usr/bin/env bash

echo "Building Lipstick on a Pigâ€¦"

# Lipstick build script.
scripts=()
scriptNames=("configure" "disable" "enable" "monitor" "uninstall" "update" "apps")

# Prepare distribution folder.
rm -rf ./dist
mkdir -p ./dist

INSTALL="dist/install"

# Create install script.
cat ./template/head.bash > "${INSTALL}"

# Bundle the scripts into install script.
for scriptName in "${scriptNames[@]}"
do
  tempVar="_${scriptName}"
  echo "" >> "${INSTALL}"
  echo "read -rd '' ${tempVar} <<-EOF" >> "${INSTALL}"
  cat "./scripts/lipstick-${scriptName}" >> "${INSTALL}"
  echo "EOF" >> "${INSTALL}"
  echo "files[${scriptName}]=${tempVar}" >> "${INSTALL}"
  echo "" >> "${INSTALL}"
  echo "######################################################################" >> "${INSTALL}"
done

# Complete install script.
cat ./template/main.bash >> "${INSTALL}"

echo 'Done.'
